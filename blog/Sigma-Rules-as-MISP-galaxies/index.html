<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/jstnk9/blog/rss.xml" title="Welcome to Jstnk webpage RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/jstnk9/blog/atom.xml" title="Welcome to Jstnk webpage Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/jstnk9/research/rss.xml" title="Welcome to Jstnk webpage RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/jstnk9/research/atom.xml" title="Welcome to Jstnk webpage Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/jstnk9/malwareandhunting/rss.xml" title="Welcome to Jstnk webpage RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/jstnk9/malwareandhunting/atom.xml" title="Welcome to Jstnk webpage Atom Feed"><title data-react-helmet="true">Sigma Rules as MISP galaxies | Welcome to Jstnk webpage</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://jstnk9.github.io/jstnk9/blog/Sigma-Rules-as-MISP-galaxies"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Sigma Rules as MISP galaxies | Welcome to Jstnk webpage"><meta data-react-helmet="true" name="description" content="A threat intelligence analyst&#x27;s brief"><meta data-react-helmet="true" property="og:description" content="A threat intelligence analyst&#x27;s brief"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-12-13T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://twitter.com/Joseliyo_Jstnk"><meta data-react-helmet="true" property="article:tag" content="threat intelligence,blue team,cybersecurity,MISP,detection engineering,sigma"><link data-react-helmet="true" rel="shortcut icon" href="/jstnk9/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://jstnk9.github.io/jstnk9/blog/Sigma-Rules-as-MISP-galaxies"><link data-react-helmet="true" rel="alternate" href="https://jstnk9.github.io/jstnk9/blog/Sigma-Rules-as-MISP-galaxies" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://jstnk9.github.io/jstnk9/blog/Sigma-Rules-as-MISP-galaxies" hreflang="x-default"><link rel="stylesheet" href="/jstnk9/assets/css/styles.26cc7d61.css">
<link rel="preload" href="/jstnk9/assets/js/runtime~main.f4b21a33.js" as="script">
<link rel="preload" href="/jstnk9/assets/js/main.f0c50aa8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/jstnk9/"><div class="navbar__logo"><img src="/jstnk9/img/msq.png" alt="logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/jstnk9/img/msq.png" alt="logo" class="themedImage_TMUO themedImage--dark_uzRr"></div></a><a class="navbar__item navbar__link" href="/jstnk9/docs/intro">Home</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/jstnk9/blog">Blog</a><a class="navbar__item navbar__link" href="/jstnk9/research">Research</a><a class="navbar__item navbar__link" href="/jstnk9/malwareandhunting">Malware &amp; Hunting</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jstnk9" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">All posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/blog/MISP-object-creator-with-Virustotal-and-Sigma">MISP object creator with VirusTotal and Sigma Galaxies</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/blog/Sigma-Rules-as-MISP-galaxies-02">Sigma Rules as MISP galaxies (II)</a></li><li class="sidebarItem_cjdF"><a aria-current="page" class="sidebarItemLink_zyXk sidebarItemLinkActive_wcJs" href="/jstnk9/blog/Sigma-Rules-as-MISP-galaxies">Sigma Rules as MISP galaxies</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/blog/TIBER-EU-ES-Blue-Team-Series-01">TIBER-EU and TIBER-ES - Blue Team</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/blog/ETW-Almulahaza">ETW-Almulahaza - new python-based tool</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/blog/TIBER-EU-ES-Red-Team-Series-01">TIBER-EU and TIBER-ES - Red Team</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/blog/TIBER-EU-ES-Threat-Intelligence-Series-01">TIBER-EU and TIBER-ES - Threat Intelligence (I)</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/blog/Threat-modeling-and-strategic-vision-of-risks">Threat modeling and strategic vision of risks</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/blog/Indicator-life-cycle-applied-to-threat-hunting">Indicator life cycle applied to threat hunting</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/blog/TypeRef Hasher-The-imphash-solution-for-samples-in-NET">TypeRef Hasher- The imphash solution for samples in .NET</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/blog/Threat-hunting-but-where-and-what-collection-management-framework">Threat Hunting, but... Where and what? - Collection Management Framework</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">Sigma Rules as MISP galaxies</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2022-12-13T00:00:00.000Z" itemprop="datePublished">December 13, 2022</time> Â· <!-- -->7 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://twitter.com/Joseliyo_Jstnk" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://jstnk9.github.io/jstnk9/img/profiles/1574890680450.jpeg" alt="Jose Luis SÃ¡nchez MartÃ­nez"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/Joseliyo_Jstnk" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jose Luis SÃ¡nchez MartÃ­nez</span></a></div><small class="avatar__subtitle" itemprop="description">Security Researcher</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_y2LR" id="a-threat-intelligence-analysts-brief">A threat intelligence analyst&#x27;s brief<a aria-hidden="true" class="hash-link" href="#a-threat-intelligence-analysts-brief" title="Direct link to heading">â€‹</a></h2><p>In the threat intelligence world, we are continuously analyzing threat actors and threats in general that impact different sectors. From a threat intelligence analyst&#x27;s point of view, it is important to know the motivations, objectives, TTPs and the overall context of the intrusion.</p><p>The results produced by these analysts are usually well defined. Frequently, a report is generated with a series of sections, where some of them are usually <code>conclusions</code>, <code>recommendations</code>, <code>countermeasures</code>.... Perhaps the least fun part for a threat intelligence analyst.</p><p>Also, in many cases additional products are generated and sent along with the report, such as STIX files with the analysis information, CSV files with IOCs, YARA rules and others. Another thing that most threat intelligence teams do is to dump all the information from the report into <code>MISP</code> including TTPs, IOCs and context information to help categorize, filter and relate the events.</p><p>From a threat intelligence point of view, our work should stop there. However, when it comes to generating a good security strategy, it is important to be able to map the techniques and behaviors identified in each intrusion with different types of rules, whether they are network or behavior-based endpoint rules.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="from-threat-intelligence-w-detection-engineering">From threat intelligence w/ detection engineering<a aria-hidden="true" class="hash-link" href="#from-threat-intelligence-w-detection-engineering" title="Direct link to heading">â€‹</a></h2><p>Many threat intelligence analysts are in fact in charge of creating such detection rules based on their own research or intrusion analysis. Realistically, however, this need not be the job of these analysts. </p><p>Detection engineers are the responsible for creating these rules to improve detections and, in some cases, visibility. Although it is true, they sometimes need help from threat intelligence analysts to understand and have context about what they want to detect and know what is happening in the wild.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="add-more-value-to-your-misp-events">Add more value to your MISP events<a aria-hidden="true" class="hash-link" href="#add-more-value-to-your-misp-events" title="Direct link to heading">â€‹</a></h2><p>As mentioned in previous points, surely as a threat intelligence analyst you usually create MISP events with IOCs and context information, such as MITRE techniques, malware families, affected countries, etc... All using MISP galaxies.</p><p>Adding galaxy-like sigma rules to your event would add value? Imagine analyzing an intrusion, identifying that there are multiple sigma rules that could have detected different behaviors, then adding those rules as galaxies.</p><p>Just for this purpose I have created a <a href="https://github.com/jstnk9/MISP/tree/main/misp-galaxy/sigma" target="_blank" rel="noopener noreferrer">script</a> that allows to generate galaxies in MISP from <a href="https://github.com/SigmaHQ/sigma" target="_blank" rel="noopener noreferrer">Sigma Rules</a>. A few months ago, I <a href="https://github.com/jstnk9/TIBER-Cases/tree/main/scripts/sigma-taxonomy-generator" target="_blank" rel="noopener noreferrer">generated a script</a> and <a href="https://twitter.com/Joseliyo_Jstnk/status/1547187670069248000" target="_blank" rel="noopener noreferrer">published</a> to create taxonomies in MISP from Sigma Rules, however, I realized that there was some context information about the rule that was missing, and I had to go into the repository itself to get it. Also, it used the rule name as the taxonomy value instead of the rule title.</p><p>Unlike MISP taxonomies, galaxies were created just for that, they allow to add more context than taxonomies, and that is why I decided to improve the previous script to create galaxies instead of taxonomies.</p><p>The idea is that from a path that you indicate to the script with the place where you have stored the rules, this begins to look for them and begins to parse them to generate two types of files. The reason of doing it through a path and not from the oficial repository is because it could be the case that there are private sigma rules that have not been shared and you want to generate the galaxy in MISP in the same way.</p><ul><li>Sigma-rules.json (cluster): This file must be placed inside the <code>/var/www/MISP/app/ files/misp-galaxy/clusters</code> directory as it contains the Sigma-rules information itself. A part of this JSON is the one we can see below.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;authors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;@Joseliyo_Jstnk&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;category&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;rules&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MISP galaxy cluster based on Sigma Rules.&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Sigma-Rules&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;source&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://github.com/jstnk9/MISP/tree/main/misp-galaxy/sigma&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sigma-rules&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;uuid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;9cf7cd2e-d5f1-48c4-9909-7896ba1c96b2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;values&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Detects a highly relevant Antivirus alert that reports an exploitation framework&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;uuid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;238527ad-3c2c-4e4f-a1f6-92fd63adb864&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;value&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Antivirus Exploitation Framework Detection&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;meta&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;refs&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;https://www.nextron-systems.com/2018/09/08/antivirus-event-analysis-cheat-sheet-v1-4/&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;https://github.com/SigmaHQ/sigma/tree/master/rules/application/antivirus/av_exploiting.yml&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;tags&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;attack.execution&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;attack.t1203&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;attack.command_and_control&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;attack.t1219&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;creation_date&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2018/09/09&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;filename&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;av_exploiting.yml&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;author&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Florian Roth&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;level&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;critical&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;falsepositive&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token string" style="color:#e3116c">&quot;Unlikely&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;logsource.category&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;antivirus&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;logsource.product&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;No established product&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .......</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>As can be seen in the above code fragment, most of the fields in the sigma rules are mapped. For those cases where the text <strong>Not established <!-- -->[something]</strong> appears, it is because the field doesn&#x27;t exist in the rule.</p><p>Something that I didn&#x27;t want to map (because I wanna think more about it) but I&#x27;m dealing with is the logic of the rule for itself. It can be difficult because the fields are dynamic.</p><ul><li>Sigma-rules.json (galaxies): This file must be placed inside the <code>/var/www/MISP/app/files/misp-galaxy/galaxies</code> directory and simply contains information about the galaxy, which will be required later in order to be used.</li></ul><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI json"><pre tabindex="0" class="prism-code language-json codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;description&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Sigma Rules are used to detect suspicious behaviors related to threat actors, malware and tools&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;icon&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;link&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Sigma-Rules&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;namespace&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;misp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sigma-rules&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;uuid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;9cf7cd2e-d5f1-48c4-9909-7896ba1c96b2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>If you want to learn more about how galaxies work and how to create one, you can do it here <a href="https://www.misp-project.org/2020/07/31/MISP-galaxy-101.html/" target="_blank" rel="noopener noreferrer">https://www.misp-project.org/2020/07/31/MISP-galaxy-101.html/</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="how-it-looks">How it looks?<a aria-hidden="true" class="hash-link" href="#how-it-looks" title="Direct link to heading">â€‹</a></h2><p>Once we have the imported galaxy in our MISP, if we navigate to it we can see something like this.</p><p><img src="https://jstnk9.github.io/jstnk9/img/blog-sigma-misp/galaxy01.png" alt="galaxy01"></p><p>The value of each item is the name of the rule, not the name of the file. This may help us in the future to do some extra implementation as well as give us much more context.</p><p>If we see the detail of any of these items, we can obtain the fields of the rule with the context information.</p><p><img src="https://jstnk9.github.io/jstnk9/img/blog-sigma-misp/galaxy02.png" alt="galax02"></p><p><img src="https://jstnk9.github.io/jstnk9/img/blog-sigma-misp/galaxy03.png" alt="galaxy03"></p><p>The more events we have stored with galaxy values on sigma rules, the more interesting the actions and statistics we can execute in the future with this information. Questions like... Which rules are detecting the most behaviors? Which logsource is giving me more information? Where do I have less visibility because I have less mapped rules? They could be answered, based on the events that are analyzed by the CTI teams in MISP.</p><p>An example could be to identify the Sigma rules that are detecting more behaviors, in order to improve them or to see the data sources that are giving us more detection value. This can be achieved using a script called <code>stats_report.py</code> which can be found <a href="https://github.com/MISP/PyMISP/blob/main/examples/stats_report.py" target="_blank" rel="noopener noreferrer">here</a>. By running it and filtering by the dates we are interested in, we can obtain a list of sigma rules and the number of events where they appear.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">myenv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> misp@misp:/opt/scripts/misp_statistics</span><span class="token comment" style="color:#999988;font-style:italic"># python3 stats_report.py -f 2022-09-01 -u 2022-11-16 | grep sigma</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Failed Code Integrity Checks&quot;</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Wow6432Node CurrentVersion Autorun Keys Modification&quot;</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Creation of an Executable by an Executable&quot;</span><span class="token plain">     </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Suspicious Execution of Taskkill&quot;</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Process Creation Using Sysnative Folder&quot;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Powershell Create Scheduled Task&quot;</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;CurrentVersion Autorun Keys Modification&quot;</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Windows Processes Suspicious Parent Directory&quot;</span><span class="token plain">          </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Windows Cmd Delete File&quot;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;User with Privileges Logon&quot;</span><span class="token plain">     </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Use Remove-Item to Delete File&quot;</span><span class="token plain">         </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;System File Execution Location Anomaly&quot;</span><span class="token plain">         </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Rundll32 With Suspicious Parent Process&quot;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Remote Thread Creation in Suspicious Targets&quot;</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Reg Add RUN Key&quot;</span><span class="token plain">        </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Python Initiated Connection&quot;</span><span class="token plain">    </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Process Start From Suspicious Folder&quot;</span><span class="token plain">   </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">misp-galaxy:sigma-rules</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;Execution from Suspicious Folder&quot;</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In case you want to consult the information in JSON format, you can always visit the following URL to obtain it <a href="http://yourmisp.com/users/statistics/tags.json" target="_blank" rel="noopener noreferrer">http://yourmisp.com/users/statistics/tags.json</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="next-steps">Next steps<a aria-hidden="true" class="hash-link" href="#next-steps" title="Direct link to heading">â€‹</a></h2><p>MISP incorporates a very interesting functionality that allows to add <strong>relationships</strong> to several clusters. That is why, in future updates, I would like to add different relationships to the Sigma galaxy such as MITRE Techniques, Software, Groups, etc.</p><p>More information about relationships and galaxies here: <a href="https://www.misp-project.org/misp-training/a.10-galaxy-2.0.pdf" target="_blank" rel="noopener noreferrer">https://www.misp-project.org/misp-training/a.10-galaxy-2.0.pdf</a></p><h2> Contact </h2><p><strong>Twitter</strong>: <a href="https://twitter.com/Joseliyo_Jstnk" target="_blank" rel="noopener noreferrer">https://twitter.com/Joseliyo_Jstnk</a></p><p><strong>LinkedIn</strong>: <a href="https://www.linkedin.com/in/joseluissm/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/joseluissm/</a></p><p><strong>GitHub Project</strong>: <a href="https://github.com/jstnk9/MISP" target="_blank" rel="noopener noreferrer">https://github.com/jstnk9/MISP</a></p><p><strong>Mastodon</strong>: <code>@Joseliyo_Jstnk@infosec.exchange</code></p><h2> References </h2><ul><li><a href="https://www.misp-project.org/misp-training/a.10-galaxy-2.0.pdf" target="_blank" rel="noopener noreferrer">https://www.misp-project.org/misp-training/a.10-galaxy-2.0.pdf</a></li><li><a href="https://www.vanimpe.eu/2019/07/13/generating-misp-data-statistical-reports/" target="_blank" rel="noopener noreferrer">https://www.vanimpe.eu/2019/07/13/generating-misp-data-statistical-reports/</a></li><li><a href="https://github.com/SigmaHQ/sigma" target="_blank" rel="noopener noreferrer">https://github.com/SigmaHQ/sigma</a></li><li><a href="https://github.com/MISP/misp-galaxy" target="_blank" rel="noopener noreferrer">https://github.com/MISP/misp-galaxy</a></li><li><a href="https://www.misp-project.org/galaxy.html" target="_blank" rel="noopener noreferrer">https://www.misp-project.org/galaxy.html</a></li></ul></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/blog/tags/threat-intelligence">threat intelligence</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/blog/tags/blue-team">blue team</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/blog/tags/cybersecurity">cybersecurity</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/blog/tags/misp">MISP</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/blog/tags/detection-engineering">detection engineering</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/blog/tags/sigma">sigma</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/jstnk9/blog/Sigma-Rules-as-MISP-galaxies-02"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« <!-- -->Sigma Rules as MISP galaxies (II)</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/jstnk9/blog/TIBER-EU-ES-Blue-Team-Series-01"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">TIBER-EU and TIBER-ES - Blue Team<!-- --> Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#a-threat-intelligence-analysts-brief" class="table-of-contents__link toc-highlight">A threat intelligence analyst&#39;s brief</a></li><li><a href="#from-threat-intelligence-w-detection-engineering" class="table-of-contents__link toc-highlight">From threat intelligence w/ detection engineering</a></li><li><a href="#add-more-value-to-your-misp-events" class="table-of-contents__link toc-highlight">Add more value to your MISP events</a></li><li><a href="#how-it-looks" class="table-of-contents__link toc-highlight">How it looks?</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next steps</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/jstnk9/docs/intro">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/jstnk9/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social Media</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/Joseliyo_Jstnk" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/joseluissm/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/jstnk9" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Jstnk Website.</div></div></div></footer></div>
<script src="/jstnk9/assets/js/runtime~main.f4b21a33.js"></script>
<script src="/jstnk9/assets/js/main.f0c50aa8.js"></script>
</body>
</html>