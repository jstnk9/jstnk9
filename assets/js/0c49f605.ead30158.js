"use strict";(self.webpackChunkjstnk=self.webpackChunkjstnk||[]).push([[6861],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return p}});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=n.createContext({}),h=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},c=function(e){var t=h(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=h(a),p=o,d=m["".concat(l,".").concat(p)]||m[p]||u[p]||i;return a?n.createElement(d,r(r({ref:t},c),{},{components:a})):n.createElement(d,r({ref:t},c))}));function p(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=a.length,r=new Array(i);r[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var h=2;h<i;h++)r[h]=a[h];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},7956:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return h},assets:function(){return c},toc:function(){return u},default:function(){return p}});var n=a(7462),o=a(3366),i=(a(7294),a(3905)),r=["components"],s={slug:"Threat-hunting-but-where-and-what-collection-management-framework",title:"Threat Hunting, but... Where and what? - Collection Management Framework",authors:"joseliyo",tags:["threat intelligence","threat huting","cybersecurity","process","CMF"]},l=void 0,h={permalink:"/jstnk9/blog/Threat-hunting-but-where-and-what-collection-management-framework",source:"@site/blog/2020-04-22-Threat-hunting-but-where-and-what-collection-management-framework/2020-04-22-Threat-hunting-but-where-and-what-collection-management-framework.md",title:"Threat Hunting, but... Where and what? - Collection Management Framework",description:"TL;DR",date:"2020-04-22T00:00:00.000Z",formattedDate:"April 22, 2020",tags:[{label:"threat intelligence",permalink:"/jstnk9/blog/tags/threat-intelligence"},{label:"threat huting",permalink:"/jstnk9/blog/tags/threat-huting"},{label:"cybersecurity",permalink:"/jstnk9/blog/tags/cybersecurity"},{label:"process",permalink:"/jstnk9/blog/tags/process"},{label:"CMF",permalink:"/jstnk9/blog/tags/cmf"}],readingTime:8.88,truncated:!0,authors:[{name:"Jose Luis S\xe1nchez Mart\xednez",title:"Security Researcher",url:"https://twitter.com/Joseliyo_Jstnk",imageURL:"https://jstnk9.github.io/jstnk9/img/profiles/1574890680450.jpeg",key:"joseliyo"}],prevItem:{title:"TypeRef Hasher- The imphash solution for samples in .NET",permalink:"/jstnk9/blog/TypeRef Hasher-The-imphash-solution-for-samples-in-NET"}},c={authorsImageUrls:[void 0]},u=[{value:"TL;DR",id:"tldr",children:[],level:2},{value:"Objective",id:"objective",children:[],level:2},{value:"Workflow",id:"workflow",children:[{value:"TTPs",id:"ttps",children:[],level:3},{value:"Tradecraft",id:"tradecraft",children:[],level:3},{value:"Malware",id:"malware",children:[],level:3},{value:"Software",id:"software",children:[],level:3}],level:2},{value:"Collection Management Framework (CMF)",id:"collection-management-framework-cmf",children:[],level:2},{value:"References",id:"references",children:[],level:2}],m={toc:u};function p(e){var t=e.components,a=(0,o.Z)(e,r);return(0,i.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"tldr"},"TL;DR"),(0,i.kt)("p",null,"Often DFIR teams must perform threat hunting actions to proactively identify anomalous behaviors in our networks or customers. However, on many occasions we do not know where to search or directly do not know which technologies we have to collect this information."),(0,i.kt)("p",null,"A Collection Management Framework (CMF) can help us in these situations. This is based on which information each data source gives us and which of these sources are available for hunting."),(0,i.kt)("h2",{id:"objective"},"Objective"),(0,i.kt)("p",null,"Before talking about what is a CMF, it is important to explain in summarized form the real meaning, because the main job of the CMF is to support this work."),(0,i.kt)("p",null,"Threat hunting is that activity that aims ",(0,i.kt)("strong",{parentName:"p"},"to proactively")," discover malicious activity of an actor or group of actors after the previous generation of hypotheses. Due to its a complex process, there are different maturity models to carry it out."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://jstnk9.github.io/jstnk9/img/blog-cmf/cmf_1.png",alt:"Image_1"})),(0,i.kt)("p",null,"Without going into much more detail about threat hunting because it is not the objective, more information about this activity and what each degree of maturity consists of can be found in the next ",(0,i.kt)("a",{target:"_blank",href:"https://medium.com/@sqrrldata/the-cyber-hunting-maturity-model-6d506faa8ad5"}," entry in Sqrrl. ")),(0,i.kt)("p",null,"Having already, organizations must be able to generate a CMF on that technology that they have and that the threat hunting team can consume to identify threats on the network. Otherwise, discovering threats will be such a tiring task that the team will not be able to meet the intelligence requirements that have been demanded of them."),(0,i.kt)("p",null,"A CMF must be able to answer many of the questions that threat hunters ask themselves during their activity, such as:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Where do I get the data for hunting?"),(0,i.kt)("li",{parentName:"ul"},"What data is available?"),(0,i.kt)("li",{parentName:"ul"},"For how long is such data stored?"),(0,i.kt)("li",{parentName:"ul"},"How can I consume the data?")),(0,i.kt)("h2",{id:"workflow"},"Workflow"),(0,i.kt)("p",null,"On many occasions, to carry out the threat hunting activity it is necessary to know what we are going to look for. In order to do this, you can generate hypotheses and work on them. However, in order to generate the hypotheses, we must know the threats that we face."),(0,i.kt)("p",null,"If we do not follow the last comments, we will be looking for something that we ourselves do not know about any generic threat that could not carry a risk for the company."),(0,i.kt)("p",null,"As an example, a possible flow to carry out threat hunting activities correctly with defined objectives would be the following:"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://jstnk9.github.io/jstnk9/img/blog-cmf/cmf_2.png",alt:"Image_2"})),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"First of all, it is important to know our adversaries and prioritize those who may have more activity and motivations in the sector that the organization operates, since they pose more risk"),". This work is done by Cyber Threat Intelligence teams."),(0,i.kt)("p",null,"Something that can help us in this case is a Threat Modeling, getting to see in a structured way those potential groups that could have interaction with us at any time. ",(0,i.kt)("a",{target:"_blank",href:"https://jstnk9.github.io/jstnk9/blog/Threat-modeling-and-strategic-vision-of-risks"}," More information on threat modeling here. ")),(0,i.kt)("p",null,"Some of the information that we will obtain in the knowledge phase about the adversary could be the following:"),(0,i.kt)("h3",{id:"ttps"},"TTPs"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Tactics, techniques and procedures used by the actor or group of actors")," that we intend to carry out hunting activities later."),(0,i.kt)("p",null,"Obtaining this information at a low level will later help the next two phases, therefore, it is highly recommended to map the tactics and techniques with the MITRE ATT&CK knowledge base in any of its variants (Enterprise, Mobile and PRE), in addition, they have just launch a beta that incorporates very comprehensive sub-techniques, more information about this ",(0,i.kt)("a",{target:"_blank",href:"https://medium.com/mitre-attack/attack-subs-what-you-need-to-know-99bce414ae0b"}," here. ")),(0,i.kt)("h3",{id:"tradecraft"},"Tradecraft"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"When we talk about tradecraft we mean the techniques, methods and technologies used by an adversary during an intrusion.")," Although it may seem very similar to TTPs, tradecraft gives a different and more specific vision, but TTPs partially abstract us from the behavior."),(0,i.kt)("p",null,"An example of tradecraft could be when we talk about an adversary using spearphishing with an attached Word document and embedded macros. After the download and subsequent execution, it drops a RAT from the FlawedAmmyy family."),(0,i.kt)("p",null,"All this mentioned above, if we were to talk about TTPs, would remain in the MITER tactics and techniques at a high level, without going into detail of families."),(0,i.kt)("h3",{id:"malware"},"Malware"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"These are all malicious capabilities developed by the actor or, failing that, reused from existing ones"),". Know them is important, since it will later help in the generation of the scenario and execution by a red team. It is also possible to extract tactics and techniques from malware individually."),(0,i.kt)("h3",{id:"software"},"Software"),(0,i.kt)("p",null,"Like malware, when we refer to software, ",(0,i.kt)("strong",{parentName:"p"},"we are talking about those capabilities that actors use during their intrusion but that are not considered malware"),", since many of these capabilities are features that are incorporated into operating systems today (LOLBINs). To make this category clear, an example might be wscript.exe or cmd.exe."),(0,i.kt)("p",null,"Generation of hypotheses based on the selected adversaries would be the next activity that should be carried out and, as in the previous case, it is the responsibility of the Cyber Threat Intelligence team."),(0,i.kt)("p",null,"Once you are able to ",(0,i.kt)("strong",{parentName:"p"},"know what your adversaries are, what TTPs they carry out during their operations, what malware and/or software they use and what motivations and objectives they are folllowing"),", you have the ability to create a scenario to carry out against your organization."),(0,i.kt)("p",null,"These scenarios can be very similar to campaigns that have been carried out in the past, but above all, they must be realistic so that the red team can emulate them in a satisfactory way."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"All this information should be collected in a report")," that will be subsequently delivered to the red team to execute it, precisely in the next phase, which is the ",(0,i.kt)("strong",{parentName:"p"},"scenario execution"),"."),(0,i.kt)("p",null,"Nowadays there are many tools that make the task of scenario emulation and detection easier in an automated way. From paid products like ",(0,i.kt)("a",{target:"_blank",href:"https://cymulate.com/"},"Cymulate")," to open source tools like ",(0,i.kt)("a",{target:"_blank",href:"https://github.com/mitre/caldera"},"Caldera")," and ",(0,i.kt)("a",{target:"_blank",href:"https://github.com/hunters-forge/mordor"},"Mordor")," can help us in this case."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Any execution that is carried out will be under the responsibility of the red team"),", which is in charge of carrying out the operations and subsequently testing the threat hunting team for detection."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Lastly, we are in the hunting phase, where the team must identify malicious activities that have been carried in the network")," with the support of a previously generated CMF, thus achieving to know where to obtain the information they are looking for and what type of information is."),(0,i.kt)("p",null,"Hunting activities are completely linked to active defenses and it is important to know that there is a very significant factor here, humans, which means that automating this phase completely is not possible, however, there are certain aspects that They can help us, such as for example an alert generated by IDS, which could lead to a subsequent hunting process."),(0,i.kt)("h2",{id:"collection-management-framework-cmf"},"Collection Management Framework (CMF)"),(0,i.kt)("p",null,"At this point, is time to start working on a CMF in order to make life easier for the threat hunting team. This work must be the result of a collaboration between different departments such as telecommunications, IT, architecture, security \u2026 Depending on each organization, there will be more or less team collaboration for the operations they carry out in their day to day."),(0,i.kt)("p",null,"The main objective of working at the CMF is to be able to have a list of all the technologies from which information can be obtained to carry out threat hunting activities and detect suspicious activities."),(0,i.kt)("p",null,"As mentioned before, it is important that the CMF can answer questions such as:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Where do I get the data for hunting?"),(0,i.kt)("li",{parentName:"ul"},"What data is available?"),(0,i.kt)("li",{parentName:"ul"},"For how long is such data stored?"),(0,i.kt)("li",{parentName:"ul"},"How can I consume the data?")),(0,i.kt)("p",null,"For this, we will define first what information we are interested in knowing for each data source available in the organization to do hunting. The good thing about this is that we can adapt it to our needs and incorporate or eliminate fields that do not interest us."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Type of data"),(0,i.kt)("li",{parentName:"ul"},"Killing chain phase covering"),(0,i.kt)("li",{parentName:"ul"},"Observable collection"),(0,i.kt)("li",{parentName:"ul"},"Data storage time"),(0,i.kt)("li",{parentName:"ul"},"Data storage location"),(0,i.kt)("li",{parentName:"ul"},"Department owner"),(0,i.kt)("li",{parentName:"ul"},"Data set"),(0,i.kt)("li",{parentName:"ul"},"Category")),(0,i.kt)("p",null,"Defined the previous points, that we are going to fill in for each data source, it is time that we begin to identify those sources that during an intrusion, could give us information to be able to look for anomalies in the organization\u2019s network. As an example for this post, we will focus on the following data sources:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Firewall"),(0,i.kt)("li",{parentName:"ul"},"Windows systems"),(0,i.kt)("li",{parentName:"ul"},"IDS"),(0,i.kt)("li",{parentName:"ul"},"Web logs")),(0,i.kt)("p",null,"Defined the fields that we are going to fill in and the data sources, it is time to get down to work and make a simple table that can help us like the following:"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://jstnk9.github.io/jstnk9/img/blog-cmf/cmf_3.png",alt:"Image_3"})),(0,i.kt)("p",null,"Simply with the information we have filled in in the table above, we can answer many questions in the event of an intrusion."),(0,i.kt)("p",null,"In case they have exploited a vulnerability of the web application, we will only have information to investigate 60 days ago, everything that happened after those days, the threat hunting team will not be able to satisfy an intelligence requirement."),(0,i.kt)("p",null,"On the contrary, if it has caused a network intrusion and establishes some type of communication with a C2, we could detect that behavior 90 days ago at best."),(0,i.kt)("p",null,"Other information that the table can give us in this case is about those phases within the kill chain where we have less visibility. In this example, due to the type of data sources that we have collected, if an infection were to occur in an endpoint system and it were to persist, we would only have the logs of the Windows systems to cover the \u201cinstallation\u201d phase, since the rest of Data sources do not cover this phase."),(0,i.kt)("p",null,"So far, all the information we have discussed can be integrated into a platform that the people of Rabobank have developed called ",(0,i.kt)("a",{target:"_blank",href:"https://github.com/rabobank-cdc/DeTTECT"},"DeTTECT.")),(0,i.kt)("p",null,"As they say, the objective of the tool is to help blue teams based on a scoring established in ATT & CK to identify the quality, visibility and detection that an organization has in its registered data sources. At this point, with the information from the CMF, we could start working on this tool."),(0,i.kt)("p",null,"To better understand how this application works, I recommend watching the ",(0,i.kt)("a",{target:"_blank",href:"https://github.com/aboutsecurity/Talks-and-Presentations/blob/master/Modelado%20Practico%20de%20Amenazas%20y%20Defensas%20Blue%20Team%20con%20MITRE.pdf"}," presentation and presentation by Ismael Valenzuela")," where he gives practical examples of DeTTECT."),(0,i.kt)("h2",{id:"references"},"References"),(0,i.kt)("p",null,"Threat Hunting and Hunting Maturity Models \u2014 ",(0,i.kt)("a",{parentName:"p",href:"https://medium.com/@sqrrldata/the-cyber-hunting-maturity-model-6d506faa8ad5"},"https://medium.com/@sqrrldata/the-cyber-hunting-maturity-model-6d506faa8ad5")),(0,i.kt)("p",null,"Adversary Emulation Plans \u2014 ",(0,i.kt)("a",{parentName:"p",href:"https://attack.mitre.org/resources/adversary-emulation-plans/"},"https://attack.mitre.org/resources/adversary-emulation-plans/")),(0,i.kt)("p",null,"Collection Management Frameworks \u2014 Beyond Asset Inventories for Preparing for and Responding to Cyber Threats \u2014 ",(0,i.kt)("a",{parentName:"p",href:"https://dragos.com/resource/collection-management-frameworks-beyond-asset-inventories-for-preparing-for-and-responding-to-cyber-threats/"},"https://dragos.com/resource/collection-management-frameworks-beyond-asset-inventories-for-preparing-for-and-responding-to-cyber-threats/")),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("br",null),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Twitter"),": ",(0,i.kt)("a",{parentName:"p",href:"https://twitter.com/Joseliyo_Jstnk"},"https://twitter.com/Joseliyo_Jstnk")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"LinkedIn"),": ",(0,i.kt)("a",{parentName:"p",href:"https://www.linkedin.com/in/joseluissm/"},"https://www.linkedin.com/in/joseluissm/")))}p.isMDXComponent=!0}}]);