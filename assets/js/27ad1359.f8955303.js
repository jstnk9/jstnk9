"use strict";(self.webpackChunkjstnk=self.webpackChunkjstnk||[]).push([[9974],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=p(n),d=a,h=m["".concat(s,".").concat(d)]||m[d]||u[d]||o;return n?r.createElement(h,i(i({ref:t},c),{},{components:n})):r.createElement(h,i({ref:t},c))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7193:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},assets:function(){return c},toc:function(){return u},default:function(){return d}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],l={slug:"ETW-Almulahaza",title:"ETW-Almulahaza - new python-based tool",authors:"joseliyo",tags:["etw","visibility","detection","microsoft","windows"]},s=void 0,p={permalink:"/jstnk9/blog/ETW-Almulahaza",source:"@site/blog/2022-06-24-ETW-Almulahaza/2022-06-24-ETW-Almulahaza.md",title:"ETW-Almulahaza - new python-based tool",description:"About the tool",date:"2022-06-24T00:00:00.000Z",formattedDate:"June 24, 2022",tags:[{label:"etw",permalink:"/jstnk9/blog/tags/etw"},{label:"visibility",permalink:"/jstnk9/blog/tags/visibility"},{label:"detection",permalink:"/jstnk9/blog/tags/detection"},{label:"microsoft",permalink:"/jstnk9/blog/tags/microsoft"},{label:"windows",permalink:"/jstnk9/blog/tags/windows"}],readingTime:1.65,truncated:!0,authors:[{name:"Jose Luis S\xe1nchez Mart\xednez",title:"Security Researcher",url:"https://twitter.com/Joseliyo_Jstnk",imageURL:"https://jstnk9.github.io/jstnk9/img/profiles/1574890680450.jpeg",key:"joseliyo"}],prevItem:{title:"TIBER-EU and TIBER-ES - Blue Team",permalink:"/jstnk9/blog/TIBER-EU-ES-Blue-Team-Series-01"},nextItem:{title:"TIBER-EU and TIBER-ES - Red Team",permalink:"/jstnk9/blog/TIBER-EU-ES-Red-Team-Series-01"}},c={authorsImageUrls:[void 0]},u=[{value:"About the tool",id:"about-the-tool",children:[],level:2},{value:"Example",id:"example",children:[],level:2}],m={toc:u};function d(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"about-the-tool"},"About the tool"),(0,o.kt)("p",null,"ETW-Almulahaza is a python-based consumer tool that I've created and I'll be updating that help you to monitor ETW traces to see what happens when you execute some malware o tool. This tools is based in ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/fireeye/pywintrace"},"pywintrace")," of FireEye."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Event Tracing for Windows (ETW) provides a mechanism to trace and log events that are raised by user-mode applications and kernel-mode drivers. ETW is implemented in the Windows operating system and provides developers a fast, reliable, and versatile set of event tracing features. ",(0,o.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/event-tracing-for-windows--etw-"},"Microsoft documentation"),".")),(0,o.kt)("p",null,"The initial version (0.0.1) that I've published right now currently supports monitoring of a specified PID or PIDs and also monitoring of explorer.exe. Also includes its childrens of the processes monitored and Thread IDs."),(0,o.kt)("p",null,"Some of the features that I would like to add are as follows:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Add config file to specify providers to monitor and task names. This config file can be read during it execution."),(0,o.kt)("li",{parentName:"ul"},"Convert outputs in other formats to enable analysts and make it actionable during their operations. I am open to listen to proposals :)."),(0,o.kt)("li",{parentName:"ul"},"Add providers on the fly to monitor new events, for example file events, registry events, defender events, etc."),(0,o.kt)("li",{parentName:"ul"},"Create graphical visualizations to see the genealogy of the processes and the events generated by each process (files created|read|modified, registry keys created|modified|deleted, etc.)"),(0,o.kt)("li",{parentName:"ul"},"Identify possibly process injection and other techniques."),(0,o.kt)("li",{parentName:"ul"},"create logics according to the types of generated events."),(0,o.kt)("li",{parentName:"ul"},"And many other features!")),(0,o.kt)("p",null,"You can see the Github project here: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/jstnk9/ETW-Almulahaza"},"https://github.com/jstnk9/ETW-Almulahaza")),(0,o.kt)("h2",{id:"example"},"Example"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://raw.githubusercontent.com/jstnk9/ETW-Almulahaza/main/img/process-tree.jpg",alt:"ptree"})),(0,o.kt)("p",null,"The above image is an example of ",(0,o.kt)("inlineCode",{parentName:"p"},"cmd.exe"),' monitoring. As you can see all the threads and subprocesses generated by each one. Also, in case the processes are stopped, the terminal will update the result by adding the word "stopped".'),(0,o.kt)("h2",null," Contact "),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Twitter"),": ",(0,o.kt)("a",{parentName:"p",href:"https://twitter.com/Joseliyo_Jstnk"},"https://twitter.com/Joseliyo_Jstnk")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"LinkedIn"),": ",(0,o.kt)("a",{parentName:"p",href:"https://www.linkedin.com/in/joseluissm/"},"https://www.linkedin.com/in/joseluissm/")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"GitHub Project"),": ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/jstnk9/ETW-Almulahaza"},"https://github.com/jstnk9/ETW-Almulahaza")),(0,o.kt)("h2",null," References and acknowledgments "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.fireeye.com/blog/threat-research/2017/09/pywintrace-python-wrapper-for-etw.html"},"https://www.fireeye.com/blog/threat-research/2017/09/pywintrace-python-wrapper-for-etw.html")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/nasbench/EVTX-ETW-Resources"},"https://github.com/nasbench/EVTX-ETW-Resources")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://twitter.com/dfirence"},"dfirence")),(0,o.kt)("li",{parentName:"ul"},"Windows Internals Part 2 book."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/event-tracing-for-windows--etw-"},"https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/event-tracing-for-windows--etw-")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/fireeye/pywintrace"},"https://github.com/fireeye/pywintrace"))))}d.isMDXComponent=!0}}]);