"use strict";(self.webpackChunkjstnk=self.webpackChunkjstnk||[]).push([[5351],{3905:function(t,e,n){n.d(e,{Zo:function(){return c},kt:function(){return u}});var a=n(7294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function l(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},i=Object.keys(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var s=a.createContext({}),p=function(t){var e=a.useContext(s),n=e;return t&&(n="function"==typeof t?t(e):o(o({},e),t)),n},c=function(t){var e=p(t.components);return a.createElement(s.Provider,{value:e},t.children)},m={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},d=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,i=t.originalType,s=t.parentName,c=l(t,["components","mdxType","originalType","parentName"]),d=p(n),u=r,h=d["".concat(s,".").concat(u)]||d[u]||m[u]||i;return n?a.createElement(h,o(o({ref:e},c),{},{components:n})):a.createElement(h,o({ref:e},c))}));function u(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var i=n.length,o=new Array(i);o[0]=d;var l={};for(var s in e)hasOwnProperty.call(e,s)&&(l[s]=e[s]);l.originalType=t,l.mdxType="string"==typeof t?t:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5703:function(t,e,n){n.r(e),n.d(e,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return p},assets:function(){return c},toc:function(){return m},default:function(){return u}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),o=["components"],l={slug:"Vietnam document exploting CVE-2022-30190 and CVE-2021-40444",title:"Vietnam document exploting CVE-2022-30190 and CVE-2021-40444",authors:"joseliyo",tags:["threat hunting","detection","analysis","research","malware","intelligence","CTI","vietnam"]},s=void 0,p={permalink:"/jstnk9/malwareandhunting/Vietnam document exploting CVE-2022-30190 and CVE-2021-40444",source:"@site/malwareandhunting/2023-10-06-vietnam-document-exploiting-cve-2022-30190-and-cve-2021-40444/2023-10-06-vietnam-document-exploiting-cve-2022-30190-and-cve-2021-40444.md",title:"Vietnam document exploting CVE-2022-30190 and CVE-2021-40444",description:"Information",date:"2023-10-06T00:00:00.000Z",formattedDate:"October 6, 2023",tags:[{label:"threat hunting",permalink:"/jstnk9/malwareandhunting/tags/threat-hunting"},{label:"detection",permalink:"/jstnk9/malwareandhunting/tags/detection"},{label:"analysis",permalink:"/jstnk9/malwareandhunting/tags/analysis"},{label:"research",permalink:"/jstnk9/malwareandhunting/tags/research"},{label:"malware",permalink:"/jstnk9/malwareandhunting/tags/malware"},{label:"intelligence",permalink:"/jstnk9/malwareandhunting/tags/intelligence"},{label:"CTI",permalink:"/jstnk9/malwareandhunting/tags/cti"},{label:"vietnam",permalink:"/jstnk9/malwareandhunting/tags/vietnam"}],readingTime:1.565,truncated:!1,authors:[{name:"Jose Luis S\xe1nchez Mart\xednez",title:"Security Researcher",url:"https://twitter.com/Joseliyo_Jstnk",imageURL:"https://jstnk9.github.io/jstnk9/img/profiles/1574890680450.jpeg",key:"joseliyo"}],prevItem:{title:"Maldoc - Dispatch of the Ministry of Industry Russia",permalink:"/jstnk9/malwareandhunting/Maldoc - Dispatch of the Ministry of Industry Russia"},nextItem:{title:"Gamaredon sample targeting Ukraine",permalink:"/jstnk9/malwareandhunting/Gamaredon sample targeting Ukraine"}},c={authorsImageUrls:[void 0]},m=[{value:"Information",id:"information",children:[],level:2},{value:"Hunting",id:"hunting",children:[],level:2},{value:"Contact",id:"contact",children:[],level:2}],d={toc:m};function u(t){var e=t.components,n=(0,r.Z)(t,o);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"information"},"Information"),(0,i.kt)("p",null,"A file uploaded from Vietnam with name ",(0,i.kt)("inlineCode",{parentName:"p"},"Phieu bo dung Ly lich.docx")," (translated to: SUPPLEMENTAL RESUME FORM) was found exploting ",(0,i.kt)("a",{parentName:"p",href:"https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-30190"},"CVE-2022-30190")," and ",(0,i.kt)("a",{parentName:"p",href:"https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-40444"},"CVE-2021-40444"),"."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"CVE-2021-40444")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Remote code execution vulnerability in MSHTML that affects Microsoft Windows. Microsoft is aware of targeted attacks that attempt to exploit this vulnerability by using specially-crafted Microsoft Office documents."),(0,i.kt)("p",{parentName:"div"},"An attacker could craft a malicious ActiveX control to be used by a Microsoft Office document that hosts the browser rendering engine. The attacker would then have to convince the user to open the malicious document. Users whose accounts are configured to have fewer user rights on the system could be less impacted than users who operate with administrative user rights."))),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"CVE-2022-30190")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"A remote code execution vulnerability exists when MSDT is called using the URL protocol from a calling application such as Word. An attacker who successfully exploits this vulnerability can run arbitrary code with the privileges of the calling application. The attacker can then install programs, view, change, or delete data, or create new accounts in the context allowed by the user\u2019s rights."))),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Field"),(0,i.kt)("th",{parentName:"tr",align:null},"Value"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"sha256"),(0,i.kt)("td",{parentName:"tr",align:null},"becb5601866206225ac8fa492b6485bddbaefa3bbeaf66748490f258eafe5589")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"filename"),(0,i.kt)("td",{parentName:"tr",align:null},"Phieu bo sung Ly lich.docx")))),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://jstnk9.github.io/jstnk9/img/img-mlw/2023-10-06/doc.jpeg",alt:"doc"})),(0,i.kt)("p",null,"When the user opens the document, malicious content is downloaded into the system from mhtml:",(0,i.kt)("a",{parentName:"p",href:"http://27.72.28%5B.%5D152:8080/LoadingUpdate.html!x-usc:http:/27.72.28%5B.%5D152:8080/LoadingUpdate.html"},"http://27.72.28[.]152:8080/LoadingUpdate.html!x-usc:http:/27.72.28[.]152:8080/LoadingUpdate.html"),"."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"msdt.exe")," is executed with a base64 to download from the same IP a svchost.exe file, which is actually a meterpreter payload."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://jstnk9.github.io/jstnk9/img/img-mlw/2023-10-06/embedded_domain.png",alt:"doc"})),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://jstnk9.github.io/jstnk9/img/img-mlw/2023-10-06/procexp.png",alt:"doc"})),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://jstnk9.github.io/jstnk9/img/img-mlw/2023-10-06/ext__contentloaded.png",alt:"doc"})),(0,i.kt)("p",null,"Finally the meterpreter establish the C2 to the same IP through the 4433 port in the IP address 27.72.28","[.]","152:4433."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://jstnk9.github.io/jstnk9/img/img-mlw/2023-10-06/vtconfig.png",alt:"doc"})),(0,i.kt)("p",null,"\ud83d\udd17 ",(0,i.kt)("strong",{parentName:"p"},"DOCx"),": ",(0,i.kt)("a",{parentName:"p",href:"https://www.virustotal.com/gui/file/becb5601866206225ac8fa492b6485bddbaefa3bbeaf66748490f258eafe5589"},"https://www.virustotal.com/gui/file/becb5601866206225ac8fa492b6485bddbaefa3bbeaf66748490f258eafe5589")),(0,i.kt)("p",null,"\ud83d\udd17 ",(0,i.kt)("strong",{parentName:"p"},"Meterpreter"),": ",(0,i.kt)("a",{parentName:"p",href:"https://www.virustotal.com/gui/file/bcb52e097c21ed88b39213abd3d3a834166e8c91366580b0353620c3a8d2bef3"},"https://www.virustotal.com/gui/file/bcb52e097c21ed88b39213abd3d3a834166e8c91366580b0353620c3a8d2bef3")),(0,i.kt)("p",null,"\ud83d\udd17 ",(0,i.kt)("strong",{parentName:"p"},"Vietnam IP"),": ",(0,i.kt)("a",{parentName:"p",href:"https://www.virustotal.com/gui/ip-address/27.72.28.152"},"https://www.virustotal.com/gui/ip-address/27.72.28.152")),(0,i.kt)("p",null,"\ud83d\udd17 ",(0,i.kt)("strong",{parentName:"p"},"Tweet"),": ",(0,i.kt)("a",{parentName:"p",href:"https://twitter.com/Joseliyo_Jstnk/status/1710206354617680086"},"https://twitter.com/Joseliyo_Jstnk/status/1710206354617680086")),(0,i.kt)("h2",{id:"hunting"},"Hunting"),(0,i.kt)("p",null,"Some interesting hunting queries related to these behaviors:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"entity:file (tag:cve-2022-30190 or tag:cve-2021-40444)\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'type:document (behavior_processes:"davclnt.dll,DavSetCookie" and behavior_processes:"http")\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'type:document behavior_processes:msdt.exe behavior_processes:mpsigstub.exe behavior:"System.Convert"\n')),(0,i.kt)("h2",{id:"contact"},"Contact"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Twitter"),": ",(0,i.kt)("a",{parentName:"p",href:"https://twitter.com/Joseliyo_Jstnk"},"https://twitter.com/Joseliyo_Jstnk")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"LinkedIn"),": ",(0,i.kt)("a",{parentName:"p",href:"https://www.linkedin.com/in/joseluissm/"},"https://www.linkedin.com/in/joseluissm/")))}u.isMDXComponent=!0}}]);