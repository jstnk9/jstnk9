<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/jstnk9/blog/rss.xml" title="Welcome to Jstnk webpage RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/jstnk9/blog/atom.xml" title="Welcome to Jstnk webpage Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/jstnk9/research/rss.xml" title="Welcome to Jstnk webpage RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/jstnk9/research/atom.xml" title="Welcome to Jstnk webpage Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/jstnk9/malwareandhunting/rss.xml" title="Welcome to Jstnk webpage RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/jstnk9/malwareandhunting/atom.xml" title="Welcome to Jstnk webpage Atom Feed"><title data-react-helmet="true">Analyzing AsyncRAT distributed in Colombia by Blind Eagle | Welcome to Jstnk webpage</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://jstnk9.github.io/jstnk9/research/AsyncRAT-Analysis"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Analyzing AsyncRAT distributed in Colombia by Blind Eagle | Welcome to Jstnk webpage"><meta data-react-helmet="true" name="description" content="Summary"><meta data-react-helmet="true" property="og:description" content="Summary"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-06-01T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://twitter.com/Joseliyo_Jstnk"><meta data-react-helmet="true" property="article:tag" content="threat hunting,detection,analysis,research,asyncrat,.NET,BlindEagle,APT-C-36"><link data-react-helmet="true" rel="shortcut icon" href="/jstnk9/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://jstnk9.github.io/jstnk9/research/AsyncRAT-Analysis"><link data-react-helmet="true" rel="alternate" href="https://jstnk9.github.io/jstnk9/research/AsyncRAT-Analysis" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://jstnk9.github.io/jstnk9/research/AsyncRAT-Analysis" hreflang="x-default"><link rel="stylesheet" href="/jstnk9/assets/css/styles.26cc7d61.css">
<link rel="preload" href="/jstnk9/assets/js/runtime~main.f4b21a33.js" as="script">
<link rel="preload" href="/jstnk9/assets/js/main.f0c50aa8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/jstnk9/"><div class="navbar__logo"><img src="/jstnk9/img/msq.png" alt="logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/jstnk9/img/msq.png" alt="logo" class="themedImage_TMUO themedImage--dark_uzRr"></div></a><a class="navbar__item navbar__link" href="/jstnk9/docs/intro">Home</a><a class="navbar__item navbar__link" href="/jstnk9/blog">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/jstnk9/research">Research</a><a class="navbar__item navbar__link" href="/jstnk9/malwareandhunting">Malware &amp; Hunting</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jstnk9" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">Recent posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/research/Malicious-Iran-Document-APT">Malicious document identified in the conflict Israel &amp; Gaza themed about terrorist organizations related to Iran</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/research/GobRAT-Malware">Dissecting GobRAT behaviors - Linux malware</a></li><li class="sidebarItem_cjdF"><a aria-current="page" class="sidebarItemLink_zyXk sidebarItemLinkActive_wcJs" href="/jstnk9/research/AsyncRAT-Analysis">Analyzing AsyncRAT distributed in Colombia by Blind Eagle</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/research/Jlaive-Antivirus-Evasion-Tool">Using Jlaive to create batch files from .NET assemblies for defense evasion</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/research/InstallScreenSaver-SCR-files">Executing SCR files using desk.cpl and InstallScreenSaver API Call</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/research/DLL-Hijacking-with-DeviceCensus.exe-on-Windows-11">DLL Hijacking with DeviceCensus.exe on Windows 11</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">Analyzing AsyncRAT distributed in Colombia by Blind Eagle</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2022-06-01T00:00:00.000Z" itemprop="datePublished">June 1, 2022</time> Â· <!-- -->12 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://twitter.com/Joseliyo_Jstnk" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://jstnk9.github.io/jstnk9/img/profiles/1574890680450.jpeg" alt="Jose Luis SÃ¡nchez MartÃ­nez"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/Joseliyo_Jstnk" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jose Luis SÃ¡nchez MartÃ­nez</span></a></div><small class="avatar__subtitle" itemprop="description">Security Researcher</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_y2LR" id="summary">Summary<a aria-hidden="true" class="hash-link" href="#summary" title="Direct link to heading">â€‹</a></h2><p>During 2019-2021 I was focused on analyzing campaigns orchestrated by the <code>APT-C-36</code> group and RATs used by this same group and other cybercriminal groups such as <code>RemcosRAT</code>, <code>AsyncRAT</code>, <code>Imminent Monitor RAT</code>, etc. In the last few months I have seen some modifications of TTPs in many of these families that have caught my attention and I wanted to analyze them to see what is new. </p><p>Therefore, during this entry we will go through the analysis of a sample of <code>AsyncRAT</code> distributed in Colombia during the last month.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>The objective of the analysis is to provide information on the execution of the binary, genealogy and other stuff, not to go into the details of the static part.</p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="analysis">Analysis<a aria-hidden="true" class="hash-link" href="#analysis" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="static">Static<a aria-hidden="true" class="hash-link" href="#static" title="Direct link to heading">â€‹</a></h3><p>The basic static information of the sample to be analyzed is shown in the table below.</p><table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody><tr><td>File name</td><td>Stub.exe</td></tr><tr><td>Type</td><td>PE32 executable for MS Windows (GUI) Intel 80386 32-bit Mono/.Net assembly</td></tr><tr><td>MD5</td><td>c0b9838ff7d2ddecbfe296eae947e5d6</td></tr><tr><td>SHA1</td><td>76af794b85e4a4ba75c5703df1207b7a6798bf2e</td></tr><tr><td>SHA256</td><td>79068b82bcf0786b6af1b7cc96de1bf4e1a66b0d95e7e72ed1b1054443f6c5e3</td></tr><tr><td>File size</td><td>45.00 KB (46080 bytes)</td></tr></tbody></table><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/01-exeinfo.jpg" alt="static01"></p><p>After verifying that the binary was C#, I decided to perform a small analysis of the code to check some of the actions that the malware should do once executed, before executing it on my systems.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/02-codebasic.png" alt="basiccode"></p><p>If we go to the <code>Main</code> function, which is the one defined in the entry point, we see that it contains the structure shown in the following image.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/03-main.png" alt="basiccode"></p><p>The binary will check a series of conditions to verify if it is being executed among other things in a virtual environment or not, and depending on the results, it will continue its normal flow or kill the process.</p><p>The first check is to verify if a series of settings established in the code, among which are the key, pastebin URL, version, etc.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/04-initializesettings.png" alt="basiccode"></p><p>Secondly, it tries to create a mutex and stop similar processes of the same sample that may be running.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/05-mutex.png" alt="mutexcheck"></p><p>It then performs several checks to identify the context where it is running (mainly to see if it is a virtual machine or a sandbox). Different anti-analysis techniques are put in place.</p><p>The first of all is related to the <code>DetectManufacturer</code> method which aims to see if the system is related to Vmware, VirtualBox, or virtualized in general.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/06-antianalysis1.png" alt="antianalysis"></p><p>The next thing is to check if a debugger exists in the context of AsyncRAT. To do this, it makes use of the <code>isDebuggerPresent</code> API. </p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/06-antianalysis2debugger.png" alt="debugg"></p><p>Next, the check is focused on seeing if the system where it was executed is the known <a href="https://github.com/sandboxie-plus/Sandboxie" target="_blank" rel="noopener noreferrer">sandboxie</a>, to check it, tries to identify if the DLL <code>SbieDll.dll</code> is running.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/06-antianalysis3sandboxie.png" alt="sandbxie"></p><p>The next check it performs is on the system disk capacity. In this case, it checks if the disk is less than 61000000000L (56.8 GB). If it is, it returns false.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/06-antianalysis5installdisk.png" alt="disk"></p><p>The last thing it performs in this set of checks is to identify if the operating system is Windows XP with a simple method.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/06-antianalysis6isXP.png" alt="xp"></p><p>It also aims to generate persistence in the system. To do this, it checks if the context of the process was launched with privileges, if so, it will make use of <code>schtasks.exe</code> to create a task. Otherwise, if the context is not found with administrator permissions, it will try to modify the registry key <code>Software\Microsoft\Windows\CurrentVersion\Run</code> to execute a copy of itself create in the <code>%appdata</code> path.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/07-scheduledpersistence.png" alt="schedule"></p><p>After this, the sample copies itself into the <code>%appdata%</code> directory and will create a .bat file to first launch a <code>timeout</code>, run the sample from <code>%appdata%</code> and delete the .bat file.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/08-batcreation.png" alt="batcreation"></p><p>The last interesting activity is to establish communications with the C2 through the <code>ClientSocket.Reconnect();</code> and <code>ClientSocket.InitializeClient();</code> methods.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/09-c2.png" alt="c2"></p><p>The sample can perform many other actions once it is deployed in the environment. For example, the <code>Client.Helper.IdSender</code> class has a method called <code>sendInfo</code> which is responsible for sending information from the operating system to the C2.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/10-sendinfo.png" alt="sendinfo"></p><p>Going into detail of each class could take a long time, and in this case, the goal is to analyze the behavior once executed, so I leave a small image of a part of the classes and methods that incorporates the sample and we will perform an analysis of the behavior.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/11-classes.png" alt="classesandmethods"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="dynamic">Dynamic<a aria-hidden="true" class="hash-link" href="#dynamic" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="high-level-processes-events">high level processes events<a aria-hidden="true" class="hash-link" href="#high-level-processes-events" title="Direct link to heading">â€‹</a></h4><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/_highlevelactivityevents.png" alt="highlevelprocesses"></p><p>Now it is time to detonate the malware in a controlled environment to verify the behavior of the malware. In this case, I did different executions with and without administrator permissions to see how the sample behaved. I did this because in the static part we have seen that the behavior could vary depending on whether it was executed in the administrator context.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="privileged-execution---genealogy">privileged execution - Genealogy<a aria-hidden="true" class="hash-link" href="#privileged-execution---genealogy" title="Direct link to heading">â€‹</a></h4><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/12-genealogy.png" alt="admingenealogy"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="non-privileged-execution---genealogy">non-privileged execution - Genealogy<a aria-hidden="true" class="hash-link" href="#non-privileged-execution---genealogy" title="Direct link to heading">â€‹</a></h4><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/12-genealogynonprivilege.png" alt="admingenealogy"></p><p>As can be seen, there are some differences when the sample was executed with privileges and when not. For example, in the first image, which corresponds to the execution with privileges, there are 3 additional processes which are the following.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">|_ cmd.exe (7380)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |_ Conhost.exe (8972)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |_ schtasks.exe (4152)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This is because the execution of the process 7380 <code>cmd.exe</code>, is the behavior related to setting the scheduled task. However, if the sample is run without administrator permissions, the scheduled task cannot be generated.</p><p>We are going to go into detail about the processes to see the main actions they performed and that could be of interest in order to generate some kind of detection or identification of patterns. To do this, we will focus on the execution with administrator permissions and in case there is something different in the other execution, it will be named.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="stubexe---2740">Stub.exe - 2740<a aria-hidden="true" class="hash-link" href="#stubexe---2740" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">C:\Users\lab\Desktop\Stub.exe</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This is the AsyncRAT sample. The execution was performed with administrator privileges.</p><p>This process, as we saw before, would be in charge of creating certain files in the system. First of all, what it does is to create in the <code>%appdata%</code> directory a copy of itself.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/14-runtimebroker.png" alt="writeruntim"></p><p>Then, it creates the batch file also in <code>%appdata%</code>, which will be executed later to perform different actions in the operating system.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/15-batfile.png" alt="writefilesbat"></p><p>As for registry keys, there is no significant activity.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Different behavior in the sample run without privileges.</p></div></div><p><strong>However, in the case of unprivileged execution, there would be a modification in the registry keys for persistence, using the key <code>HKCU\Software\Microsoft\Windows\CurrentVersion\Run\Runtime Broker</code></strong>.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/16-registrykeyrun.png" alt="registrykey"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="cmdexe---7380">cmd.exe - 7380<a aria-hidden="true" class="hash-link" href="#cmdexe---7380" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;C:\Windows\System32\cmd.exe&quot; /c schtasks /create /f /sc onlogon /rl highest /tn &quot;Runtime Broker&quot; /tr &#x27;&quot;C:\Users\lab\AppData\Roaming\Runtime Broker.exe&quot;&#x27; &amp; exit</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This process is basically in charge of launching the <code>schtasks.exe</code> binary. It is important to mention, as we are seeing and will see throughout the analysis, that since this is a 32bit sample, the executions will be related to the <code>C:\Windows\SysWOW64\</code> directory.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/17-scheduledcreatedprocess.png" alt="registrykey"></p><p>This process will not exist when running AsyncRAT without administrator permissions.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="schtasksexe---4152">schtasks.exe - 4152<a aria-hidden="true" class="hash-link" href="#schtasksexe---4152" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">schtasks  /create /f /sc onlogon /rl highest /tn &quot;Runtime Broker&quot; /tr &#x27;&quot;C:\Users\lab\AppData\Roaming\Runtime Broker.exe&quot;&#x27; </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The task is generated in the system to be executed at each login of any user with administrator permissions.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">/f -&gt; A value that forcefully creates the task and suppresses warnings if the specified task already exists.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/sc onlogon -&gt; In each login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/rl highest -&gt; Max privileges</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/tn &quot;Runtime Broker&quot; -&gt; Task name </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/tr &quot;C:\Users\lab\AppData\Roaming\Runtime Broker.exe&quot; -&gt; Task run to execute</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/18-taskscheduled.png" alt="task"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="cmdexe---8840">cmd.exe - 8840<a aria-hidden="true" class="hash-link" href="#cmdexe---8840" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">C:\Windows\system32\cmd.exe /c &quot;&quot;C:\Users\lab\AppData\Local\Temp\tmp3959.tmp.bat&quot;&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This process is in charge of executing the bat file that was created during the execution of the <code>Stub.exe</code> binary. It is important to mention that <strong>the name of the batch file varies according to the execution</strong>, however, <strong>the pattern is always the same</strong>. The following RegEx would work to detect this.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">.*tmp[a-zA-Z1-9]{4}.tmp.bat</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/19-batnames.png" alt="task"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="timeoutexe---6272">timeout.exe - 6272<a aria-hidden="true" class="hash-link" href="#timeoutexe---6272" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">timeout  3 </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The malware uses a timeout of 3 seconds before it starts performing the rest of the actions.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="runtime-brokerexe---4080">Runtime Broker.exe - 4080<a aria-hidden="true" class="hash-link" href="#runtime-brokerexe---4080" title="Direct link to heading">â€‹</a></h4><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;C:\Users\lab\AppData\Roaming\Runtime Broker.exe&quot; </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>As can be seen from the name of the process, the malware tries to impersonate the legitimate Microsoft Windows binary <code>runtimebroker.exe</code>. However, it can be noticed in this case that there is a space between the two words.</p><p>Here the communication with the C2 server is established. The ports used in this case are 8808, 7707 and 6606. The destination IP address is 217.195.197<!-- -->[.]<!-- -->70.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/20-connections.png" alt="connections"></p><p>On the other hand, another indicator that could help us to identify the sample and the family during the analysis is the Mutex used, which in this case is <code>AsyncMutex_6SI8OkPnk</code>.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/22-MutantAsync.png" alt="mutex"></p><p>During the execution of <code>Runtime Broker.exe</code>, I proceeded to extract the .NET assembly from memory to verify if it was the same <code>Stub.exe</code> binary analyzed later or if it presented some difference when is launched. During this extraction, the following assemblies were obtained from memory.</p><table><thead><tr><th>File name</th><th>SHA1</th><th>Comments</th></tr></thead><tbody><tr><td>aB.exe</td><td>76AF794B85E4A4BA75C5703DF1207B7A6798BF2E</td><td>Same sample as <code>Stub.exe</code></td></tr><tr><td>MessagePackLib.dll</td><td>16CC8C3A461A6CE5A7ED1FF569EA61B8D9BA143E</td><td>At the time of analysis, 41/68 engines in VT detect it as malicious. Different family names.</td></tr><tr><td>Recovery.dll</td><td>93E9469789A4ECD28E30006D1CE10DBFFBD36D7C</td><td>At the time of analysis, 44/68 engines in VT detect it as malicious. Code protected by <a href="https://www.eziriz.com/" target="_blank" rel="noopener noreferrer">Reactor</a>.</td></tr><tr><td>System.Data.SQLite.dll</td><td>B9D5AF76D8DF1C4EE4CCBA33B2AFA8300952D923</td><td>Mixed-mode assembly for System.Data.SQLite. More information <a href="https://system.data.sqlite.org/index.html/doc/trunk/www/downloads.wiki" target="_blank" rel="noopener noreferrer">here</a>.</td></tr><tr><td>Newtonsoft.Json.dll</td><td>E68B369BC131A32D5233EE395F47B337C2469042</td><td>Json.NET is a popular high-performance JSON framework for .NET</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_y2LR" id="abexe">aB.exe<a aria-hidden="true" class="hash-link" href="#abexe" title="Direct link to heading">â€‹</a></h4><p>The assembly <code>aB.exe</code> is the same <code>Stub.exe</code> file, which in turn is also <code>Runtime Broker.exe</code>. </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="messagepacklibdll">MessagePackLib.dll<a aria-hidden="true" class="hash-link" href="#messagepacklibdll" title="Direct link to heading">â€‹</a></h4><p>This DLL does not contain any packers or code protectors. 41 out of 68 <a href="https://www.virustotal.com/gui/file/cd89c8c9bb614fac779491b98ed425f90b01412381e02392fb27b36db3568b0f" target="_blank" rel="noopener noreferrer">VT</a> engines detect this DLL as malicious.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/24-message.png" alt="nopacker"></p><p>Taking a look at the assembly, you can see that the class structure does not seem to be very complex, and with a little patience you could identify its functionality (if you are interested in the sample, ask me privately).</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/25-messagepackassembly.png" alt="assemblymessage"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="recoverydll">Recovery.dll<a aria-hidden="true" class="hash-link" href="#recoverydll" title="Direct link to heading">â€‹</a></h4><p>In this case, it has been possible to verify the existence of Reactor, <a href="https://www.eziriz.com/" target="_blank" rel="noopener noreferrer">called by itself as a .NET code protection</a> as can be seen on its website.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/23-dieReactor.png" alt="recoverypacker"></p><p>As for the assembly, it can be verified that there is a protection of the code, since many strings and classes are randomized at the moment of observing their possible logic.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/26-recoveryassembly.png" alt="recoverypacker"></p><p>In a process of trying to remove the code protection, it is possible to see in a more readable way part of the code, identifying messages of actions that the assembly could try, in this case as seen in the image, related to the obtaining of Firefox cookies.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/27-codeunprotected.png" alt="unprotectedcode"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="high-level-graph">High level graph<a aria-hidden="true" class="hash-link" href="#high-level-graph" title="Direct link to heading">â€‹</a></h3><p>In order to have a graphical view of the most important events that take place during the execution of AsyncRAT, a behavior graph has been elaborated where the events generated in the system during its execution can be seen.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/_graph.jpg" alt="graph"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="diamond-model">Diamond model<a aria-hidden="true" class="hash-link" href="#diamond-model" title="Direct link to heading">â€‹</a></h3><p><img src="https://jstnk9.github.io/jstnk9/img/research-asyncrat-analysis01/_diamond.jpg" alt="graph"></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="attck">ATT&amp;CK<a aria-hidden="true" class="hash-link" href="#attck" title="Direct link to heading">â€‹</a></h2><table><thead><tr><th>Technique</th><th>Kill chain phase</th><th>Diamond vertex</th><th>Comments</th></tr></thead><tbody><tr><td>T1566.001 - Phishing: Spearphishing Attachment</td><td>Delivery</td><td>Capability</td><td>Email with ZIP file attached</td></tr><tr><td>T1547.001 - Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder</td><td>Installation</td><td>Capability</td><td>Set registry key if non-privileged user executes the payload</td></tr><tr><td>T1053.005 - Scheduled Task/Job: Scheduled Task</td><td>Installation</td><td>Capability</td><td>Creates new scheduled task if privileged user executes the payload</td></tr><tr><td>T1036.005 - Masquerading: Match Legitimate Name or Location</td><td>Execution</td><td>Capability</td><td>Writes itself as a file named Runtime Broker.exe saved in %APPDATA%</td></tr><tr><td>T1571 - Non-Standard Port</td><td>C2</td><td>Infrastructure</td><td>Use the ports 8808, 7707 and 6606 for communication</td></tr><tr><td>T1059.003 - Command and Scripting Interpreter: Windows Command Shell</td><td>Execution</td><td>Capability</td><td>Executes batch file created previously</td></tr><tr><td>T1027 - Obfuscated Files or Information</td><td>Exploitation</td><td>Capability</td><td>.NET Reactor is used for code protection</td></tr><tr><td>T1095 - Non-Application Layer Protocol</td><td>C2</td><td>Infrastructure</td><td>TCP is used for C2 communications</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_y2LR" id="iocs">IOCs<a aria-hidden="true" class="hash-link" href="#iocs" title="Direct link to heading">â€‹</a></h2><ul><li>217.195.197<!-- -->[.]<!-- -->70 through 6606, 7707, 8808 ports</li><li>76AF794B85E4A4BA75C5703DF1207B7A6798BF2E</li><li>16CC8C3A461A6CE5A7ED1FF569EA61B8D9BA143E</li><li>93E9469789A4ECD28E30006D1CE10DBFFBD36D7C</li><li>Mutex <code>AsyncMutex_6SI8OkPnk</code></li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="sigma-rules">Sigma rules<a aria-hidden="true" class="hash-link" href="#sigma-rules" title="Direct link to heading">â€‹</a></h2><p><strong><em>The sigma rules created are specifics for this payload.</em></strong> There will be different payloads used by AsyncRAT with the same name or different. Is important to mention that the original filename embbeded in this case is <code>Stub.exe</code>. This is interesting because if the adversaries create new payloads, maybe the original filename will still being the same.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yml"><pre tabindex="0" class="prism-code language-yml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Detect AsyncRAT persistence with schtasks based on specific payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 4410f0ad</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">3a1c</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">4e21</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">9e3a</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">fa55336aa123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Detect the execution of the AsyncRAT payload to launch schtask for persistence.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> experimental</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">date</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2022/06/01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">modified</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2022/06/01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">author</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Jose Luis Sanchez Martinez (@Joseliyo_Jstnk)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">references</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//jstnk9.github.io/jstnk9/research/AsyncRAT</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Analysis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//www.virustotal.com/gui/file/79068b82bcf0786b6af1b7cc96de1bf4e1a66b0d95e7e72ed1b1054443f6c5e3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">logsource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">product</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> windows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">category</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> process_creation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">detection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parent_selection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ParentImage|endswith</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Stub.exe&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selection1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Image|endswith</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\cmd.exe&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">CommandLine|contains|all</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;schtasks &#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> &#x27;\AppData\Roaming\&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.exe&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> parent_selection and selection1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">falsepositives</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">level</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> medium</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> attack.persistence</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> attack.T1053.005</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yml"><pre tabindex="0" class="prism-code language-yml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Detect AsyncRAT execution based on specific payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ac891380</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">958b</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">4c08</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a77d</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">8e149d63d741</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Detect the execution of the AsyncRAT payload to establish registry key for persistence.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> experimental</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">date</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2022/06/01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">modified</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2022/06/01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">author</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Jose Luis Sanchez Martinez (@Joseliyo_Jstnk)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">references</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//jstnk9.github.io/jstnk9/research/AsyncRAT</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Analysis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//www.virustotal.com/gui/file/79068b82bcf0786b6af1b7cc96de1bf4e1a66b0d95e7e72ed1b1054443f6c5e3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">logsource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">product</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> windows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">category</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry_set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">detection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">EventType</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> SetValue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Image|endswith</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Stub.exe&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">TargetObject|endswith</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &#x27;\Software\Microsoft\Windows\CurrentVersion\Run\&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Details|contains</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.exe&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> selection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">falsepositives</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">level</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> medium</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> attack.persistence</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> attack.t1547.001</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>In the original <a href="https://github.com/SigmaHQ/sigma/tree/master/rules/windows" target="_blank" rel="noopener noreferrer">Sigma</a> repository, there are a large number of generic rules that can help in the detection of this malware.</p><h2> Contact </h2><p><strong>Twitter</strong>: <a href="https://twitter.com/Joseliyo_Jstnk" target="_blank" rel="noopener noreferrer">https://twitter.com/Joseliyo_Jstnk</a></p><p><strong>LinkedIn</strong>: <a href="https://www.linkedin.com/in/joseluissm/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/joseluissm/</a></p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/research/tags/threat-hunting">threat hunting</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/research/tags/detection">detection</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/research/tags/analysis">analysis</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/research/tags/research">research</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/research/tags/asyncrat">asyncrat</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/research/tags/net">.NET</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/research/tags/blind-eagle">BlindEagle</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/research/tags/apt-c-36">APT-C-36</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/jstnk9/research/GobRAT-Malware"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« <!-- -->Dissecting GobRAT behaviors - Linux malware</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/jstnk9/research/Jlaive-Antivirus-Evasion-Tool"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Using Jlaive to create batch files from .NET assemblies for defense evasion<!-- --> Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#analysis" class="table-of-contents__link toc-highlight">Analysis</a><ul><li><a href="#static" class="table-of-contents__link toc-highlight">Static</a></li><li><a href="#dynamic" class="table-of-contents__link toc-highlight">Dynamic</a></li><li><a href="#high-level-graph" class="table-of-contents__link toc-highlight">High level graph</a></li><li><a href="#diamond-model" class="table-of-contents__link toc-highlight">Diamond model</a></li></ul></li><li><a href="#attck" class="table-of-contents__link toc-highlight">ATT&amp;CK</a></li><li><a href="#iocs" class="table-of-contents__link toc-highlight">IOCs</a></li><li><a href="#sigma-rules" class="table-of-contents__link toc-highlight">Sigma rules</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/jstnk9/docs/intro">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/jstnk9/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social Media</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/Joseliyo_Jstnk" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/joseluissm/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/jstnk9" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Jstnk Website.</div></div></div></footer></div>
<script src="/jstnk9/assets/js/runtime~main.f4b21a33.js"></script>
<script src="/jstnk9/assets/js/main.f0c50aa8.js"></script>
</body>
</html>